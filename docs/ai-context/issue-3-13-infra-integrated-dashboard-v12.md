# Issue #3-13: 인프라 통합 모니터링 대시보드 구축 및 고도화 (Phase 1)

## 📅 날짜: 2026-01-06
## 👤 참여자: [임성현], Gemini

## 1. 이슈 개요
- **목표**: 물리 서버(Mini PC 6대), 일반 VM, K8s 클러스터 자원을 한눈에 파악할 수 있는 통합 진단 대시보드 구축.
- **핵심 요구사항**: 
  - 1서버당 1행으로 요약된 인벤토리 형태의 테이블 구성.
  - 물리 서버의 온도(실시간/평균)와 자원 점유율(%)의 병렬 배치.
  - IP:포트 형태의 라벨을 호스트네임으로 정제하여 가독성 확보.

## 2. 세부 작업 및 기술 결정

### 2.1 데이터 정제 로직 설계 (Label Normalization)
- **문제**: Prometheus 쿼리 시 `instance` 라벨에 포트 번호(`:9100`)가 포함되어, 서로 다른 메트릭(CPU, RAM, Temp)이 Grafana 테이블에서 동일 서버로 합쳐지지 않고 여러 줄로 찢어지는 현상 발생.
- **해결**: 모든 PromQL 쿼리에 `label_replace` 함수를 적용하여 포트 번호를 강제 제거.
  - 예시: `label_replace(metric, "instance", "$1", "instance", "(.*):.*")`

### 2.2 테이블 레이아웃 최적화 (v1 ~ v12)
- **변환(Transform) 체인 구축**:
  - **Merge**: 서로 다른 시계열 데이터를 인스턴스 기준으로 가로로 병합.
  - **Reduce**: 시계열 데이터를 '최신값(Last)' 기준으로 압축하여 1행 1서버 구조 확립.
  - **Organize Fields**: 불필요한 `Time` 필드 제거 및 `Host | Cores | RAM | Temp | CPU% | RAM%` 순으로 정렬.
- **단위(Unit) 보정**: 원시 숫자(bytes)를 `GiB`, `Celsius`, `Percent` 단위로 매핑하여 가시성 확보.

## 3. [트러블슈팅] 시각화 구현의 난관

### 3.1 테이블 데이터 파편화 이슈
- **증상**: 테이블 내에서 동일 IP의 데이터가 시간대별 혹은 지표별로 수십 줄 나열됨.
- **원인**: Grafana의 '시계열' 데이터 처리 방식과 Prometheus 라벨 불일치가 복합적으로 작용.
- **결론**: `Reduce`와 `Merge` 변환의 순서가 중요함을 확인하고, 최종적으로 인벤토리 스타일의 도면 확정.

## 4. 최종 결정 및 보류
- **결정**: 대시보드의 시각적 완성도(v12)는 확보되었으나, 실질적인 인프라 운영을 위해 **외부 접속 통로(Gateway)** 확보가 더 시급하다고 판단.
- **조치**: 대시보드 세부 튜닝은 하드웨어 부하 발생 시 재개하기로 하고, Bastion Nginx 서버 구축 단계로 전환.