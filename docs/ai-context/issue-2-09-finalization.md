# Issue #2-09: Kubernetes Cluster êµ¬ì„± ë° ì¸í”„ë¼ ê¸°ì´ˆ ê³µì‚¬ ì¢…ë£Œ

## 1. ì´ìŠˆ ê°œìš”
- **ëª©í‘œ**: 6ëŒ€ì˜ Mini-PC ìì›ì„ í†µí•©í•˜ëŠ” Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì„ ì™„ë£Œí•˜ê³ , DNS ë° ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì„ ìµœì í™”í•˜ì—¬ ì¸í”„ë¼ ë ˆì´ì–´(Issue #2)ë¥¼ ìµœì¢… ì¢…ë£Œí•¨.
- **ê²°ê³¼**: 1 Master + 5 Workers êµ¬ì¡°ì˜ ê°€ë™ í™•ì¸ ë° CNI(Calico) ë°°í¬ ì™„ë£Œ.

## 2. ê¸°ìˆ ì  ì˜ì‚¬ê²°ì •: Calico CNI ì„ íƒ ì´ìœ 
ë‹¨ìˆœ ì—°ê²°ì„ ì§€ì›í•˜ëŠ” Flannel ëŒ€ì‹  **Calico**ë¥¼ ì„ íƒí•œ í•µì‹¬ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
- **ê³ ì„±ëŠ¥ L3 ë¼ìš°íŒ…**: VXLANê³¼ ê°™ì€ ìº¡ìŠí™” ì˜¤ë²„í—¤ë“œ ì—†ì´ í˜¸ìŠ¤íŠ¸ ê°„ BGP ë¼ìš°íŒ…ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì²˜ë¦¬ëŸ‰ì´ ë§ì€ Spark/Kafka í™˜ê²½ì— ìµœì í™”ë¨.
- **ì„¸ë°€í•œ ë³´ì•ˆ ì •ì±… (Network Policy)**: CRM ë°ì´í„° ìˆ˜ì§‘ë¶€ì™€ ë¶„ì„ë¶€(Spark/DW) ê°„ì˜ í†µì‹  ê¶Œí•œì„ ì œì–´í•˜ì—¬ ë°ì´í„° ê±°ë²„ë„ŒìŠ¤ ë° ë³´ì•ˆ í™•ë³´ ê°€ëŠ¥.
- **í™•ì¥ì„±**: ì¶”í›„ ë…¸ë“œ ì¶”ê°€ ì‹œì—ë„ íš¨ìœ¨ì ì¸ ë¼ìš°íŒ… í…Œì´ë¸” ê´€ë¦¬ê°€ ê°€ëŠ¥í•¨.

## 3. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…: DNS ì„¤ì • ì˜êµ¬ ë°˜ì˜ (Netplan)
Cloud-init ê¸°ë°˜ VMì—ì„œ `/etc/resolv.conf` ìˆ˜ì • ì‹œ ì¬ë¶€íŒ… í›„ ì´ˆê¸°í™”ë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Netplanì„ í†µí•œ ì˜êµ¬ ì„¤ì •ì„ ì ìš©í•¨.

### ğŸ›  í•´ê²° í”„ë¡œì„¸ìŠ¤
1. **ì¸í„°í˜ì´ìŠ¤ í™•ì¸**: `ls /etc/netplan/`ì„ í†µí•´ `50-cloud-init.yaml` í™•ì¸.
2. **ì„¤ì • ìˆ˜ì •**: `nameservers` ì„¹ì…˜ì„ ì¶”ê°€í•˜ì—¬ `8.8.8.8`, `8.8.4.4` ë“± êµ¬ê¸€ DNS ë° ê²€ìƒ‰ ë„ë©”ì¸ ì£¼ì….
3. **ì˜êµ¬ ë§í¬ ê³ ì •**:
   ```bash
   sudo netplan apply
   sudo rm /etc/resolv.conf
   sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf
   ```
- ì„±ê³¼: ì¬ë¶€íŒ… í›„ì—ë„ DNS í•´ì„ ëŠ¥ë ¥ì´ ìœ ì§€ë˜ë©°, ëª¨ë“  ì›Œì»¤ ë…¸ë“œì˜ ì„¤ì • íŒŒì¼ í˜•ì‹ì„ í†µì¼í•˜ì—¬ ê´€ë¦¬ íš¨ìœ¨ì„±ì„ ë†’ì„.

## 4. ìµœì¢… í™•ì • ì¸í”„ë¼ ë¦¬ìŠ¤íŠ¸ (VM Inventory)

| êµ¬ë¶„ | VM ID | Hostname | IP (192.168.0.x) | Target Node | Template | ë¹„ê³  |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **ê¸°ì¡´** | 100 | `vm-bastion` | .10 | server-06 | - | Tailscale/Ansible Host |
| **ê¸°ì¡´** | 101 | `kafka-01` | .11 | server-01 | - | Broker 01 |
| **ê¸°ì¡´** | 102 | `kafka-02` | .12 | server-02 | - | Broker 02 |
| **ê¸°ì¡´** | 103 | `kafka-03` | .13 | server-03 | - | Broker 03 |
| **ì‹ ê·œ** | **104** | `minio-server` | .14 | server-04 | 901 | Object Storage (VM) |
| **ì‹ ê·œ** | **105** | `postgres-dw` | .15 | server-05 | 901 | Data Warehouse (VM) |
| **ì‹ ê·œ** | **106** | `infra-prom-01` | .16 | server-06 | 901 | VM/Host Prometheus ì „ìš© |
| **ì‹ ê·œ** | **300** | `k8s-master-01` | .30 | server-01 | 902 | Control Plane |
| **ì‹ ê·œ** | **301** | `k8s-worker-01` | .31 | server-02 | 902 | Spark Worker 01 |
| **ì‹ ê·œ** | **302** | `k8s-worker-02` | .32 | server-03 | 902 | Spark Worker 02 |
| **ì‹ ê·œ** | **303** | `k8s-worker-03` | .33 | server-04 | 902 | Airflow/Services |
| **ì‹ ê·œ** | **304** | `k8s-worker-04` | .34 | server-05 | 902 | Spike Generator |
| **ì‹ ê·œ** | **305** | `k8s-worker-05` | .35 | server-06 | 902 | Grafana + K8s Prom Stack |

## 5. ê²°ë¡  ë° í–¥í›„ ê³„íš

- Issue #2 ì¢…ë£Œ: 6ëŒ€ì˜ Mini-PCì— ê±¸ì¹œ ë¶„ì‚° í™˜ê²½ ì¸í”„ë¼ ì…‹ì—…ì´ ì™„ë£Œë¨.
- Issue #3 ì‹œì‘ (Current Repo): K8s ìœ„ì—ì„œ ëŒì•„ê°ˆ Kafka/Spark/MinIO ë“±ì˜ ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ìŠ¤íƒ êµ¬ì„±.
- ë³„ë„ í”„ë¡œì íŠ¸ ì°©ìˆ˜ (Separate Repo): CRM ë°ì´í„°ë¼ì´ì¦ˆí–¥(å‘) ì‚¬ìš©ì í–‰ë™ ë¡œê·¸ ì‹œë®¬ë ˆì´í„° ê°œë°œ ì‹œì‘.